{"cells":[{"cell_type":"code","execution_count":null,"metadata":{"id":"JHk9cL4LbS-X"},"outputs":[],"source":["import pandas as pd\n","import numpy as np\n","from google.colab import drive\n","import matplotlib.pyplot as plt\n","import json\n","from collections import Counter\n","import random"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"XzL7h7QsbvOu","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1673449607076,"user_tz":300,"elapsed":28877,"user":{"displayName":"Maria Ibargoyen","userId":"09869936973664176898"}},"outputId":"61461aac-ef90-4656-9f8c-26c6d66451d6"},"outputs":[{"output_type":"stream","name":"stdout","text":["Mounted at /content/drive\n"]}],"source":["drive.mount('/content/drive')"]},{"cell_type":"markdown","metadata":{"id":"LFNXmCKKb_OQ"},"source":["**Safegraph**"]},{"cell_type":"code","source":["#Import safegrap patterns & places\n","safegraph_ma = pd.read_csv ('drive/MyDrive/Amenities/data/safegraph_ma.csv', index_col = False)\n","safegraph_ma.head(3)"],"metadata":{"id":"kJiEXMq64zxv","colab":{"base_uri":"https://localhost:8080/","height":239},"executionInfo":{"status":"ok","timestamp":1673449613799,"user_tz":300,"elapsed":3733,"user":{"displayName":"Maria Ibargoyen","userId":"09869936973664176898"}},"outputId":"a1a9ea23-bc4e-491b-9986-e48e6f7b4e25"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["              placekey  naics_code  naics_category  raw_visit_counts  \\\n","0  zzy-222@65y-y8f-kpv    611310.0              61             216.0   \n","1  zzy-222@62j-ynz-249    442110.0              44              36.0   \n","2  zzw-222@62j-srz-zvf    524210.0              52              37.0   \n","\n","        poi_cbg                                       top_category  \\\n","0  2.500390e+11   Colleges, Universities, and Professional Schools   \n","1  2.500101e+11                                   Furniture Stores   \n","2  2.501737e+11  Agencies, Brokerages, and Other Insurance Rela...   \n","\n","                                       sub_category  \\\n","0  Colleges, Universities, and Professional Schools   \n","1                                  Furniture Stores   \n","2                 Insurance Agencies and Brokerages   \n","\n","                    location_name  \n","0     Berkshire Community College  \n","1                     Mill Stores  \n","2  Coyle David J Insurance Agency  "],"text/html":["\n","  <div id=\"df-4a55f1c3-6690-4fb4-98ae-11d044e9b2b1\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>placekey</th>\n","      <th>naics_code</th>\n","      <th>naics_category</th>\n","      <th>raw_visit_counts</th>\n","      <th>poi_cbg</th>\n","      <th>top_category</th>\n","      <th>sub_category</th>\n","      <th>location_name</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>zzy-222@65y-y8f-kpv</td>\n","      <td>611310.0</td>\n","      <td>61</td>\n","      <td>216.0</td>\n","      <td>2.500390e+11</td>\n","      <td>Colleges, Universities, and Professional Schools</td>\n","      <td>Colleges, Universities, and Professional Schools</td>\n","      <td>Berkshire Community College</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>zzy-222@62j-ynz-249</td>\n","      <td>442110.0</td>\n","      <td>44</td>\n","      <td>36.0</td>\n","      <td>2.500101e+11</td>\n","      <td>Furniture Stores</td>\n","      <td>Furniture Stores</td>\n","      <td>Mill Stores</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>zzw-222@62j-srz-zvf</td>\n","      <td>524210.0</td>\n","      <td>52</td>\n","      <td>37.0</td>\n","      <td>2.501737e+11</td>\n","      <td>Agencies, Brokerages, and Other Insurance Rela...</td>\n","      <td>Insurance Agencies and Brokerages</td>\n","      <td>Coyle David J Insurance Agency</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-4a55f1c3-6690-4fb4-98ae-11d044e9b2b1')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-4a55f1c3-6690-4fb4-98ae-11d044e9b2b1 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-4a55f1c3-6690-4fb4-98ae-11d044e9b2b1');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":3}]},{"cell_type":"code","source":["len(safegraph_ma)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"JSXptmj4ffJV","executionInfo":{"status":"ok","timestamp":1671069305854,"user_tz":300,"elapsed":178,"user":{"displayName":"Maria Ibargoyen","userId":"09869936973664176898"}},"outputId":"30514b29-743a-4018-9e67-f508ff6391f1"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["141489"]},"metadata":{},"execution_count":19}]},{"cell_type":"code","source":["safegraph_ma=safegraph_ma.drop_duplicates(subset=['placekey']).reset_index().drop('index', axis = 1)"],"metadata":{"id":"D2uNqZI233Tj"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["safegraph_ma=safegraph_ma[safegraph_ma['raw_visit_counts'].notnull()]"],"metadata":{"id":"Sdr2d8KJ1vMo"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["len(safegraph_ma)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"Eg7uWyYT15jc","executionInfo":{"status":"ok","timestamp":1673449624128,"user_tz":300,"elapsed":716,"user":{"displayName":"Maria Ibargoyen","userId":"09869936973664176898"}},"outputId":"75ba20dd-056c-401b-c22f-90f24d9c8f86"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["67793"]},"metadata":{},"execution_count":7}]},{"cell_type":"markdown","metadata":{"id":"m0jVFHTaexT2"},"source":["**Replica (trips)**"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"I24Rgpzqdq8c","colab":{"base_uri":"https://localhost:8080/","height":112},"executionInfo":{"status":"ok","timestamp":1673451771852,"user_tz":300,"elapsed":2367,"user":{"displayName":"Maria Ibargoyen","userId":"09869936973664176898"}},"outputId":"2ecca0a5-1703-4e02-815b-25d03086af65"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["    activity_id     person_id  household_id            mode travel_purpose  \\\n","0  1.415185e+19  3.820938e+18  4.456505e+18         CARPOOL     RECREATION   \n","1  5.174423e+18  1.503045e+19  1.449734e+19  PUBLIC_TRANSIT     RECREATION   \n","\n","   duration_minutes  distance_miles   origin_bgrp  destination_bgrp  \\\n","0             111.0      101.180729  2.300502e+11      2.502507e+11   \n","1              59.0        7.325792  2.502505e+11      2.502598e+11   \n","\n","   naics_code  naics_category  \n","0    713940.0              71  \n","1    713940.0              71  "],"text/html":["\n","  <div id=\"df-f73e9bff-c31a-425f-b4c4-0043ed140280\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>activity_id</th>\n","      <th>person_id</th>\n","      <th>household_id</th>\n","      <th>mode</th>\n","      <th>travel_purpose</th>\n","      <th>duration_minutes</th>\n","      <th>distance_miles</th>\n","      <th>origin_bgrp</th>\n","      <th>destination_bgrp</th>\n","      <th>naics_code</th>\n","      <th>naics_category</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>1.415185e+19</td>\n","      <td>3.820938e+18</td>\n","      <td>4.456505e+18</td>\n","      <td>CARPOOL</td>\n","      <td>RECREATION</td>\n","      <td>111.0</td>\n","      <td>101.180729</td>\n","      <td>2.300502e+11</td>\n","      <td>2.502507e+11</td>\n","      <td>713940.0</td>\n","      <td>71</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>5.174423e+18</td>\n","      <td>1.503045e+19</td>\n","      <td>1.449734e+19</td>\n","      <td>PUBLIC_TRANSIT</td>\n","      <td>RECREATION</td>\n","      <td>59.0</td>\n","      <td>7.325792</td>\n","      <td>2.502505e+11</td>\n","      <td>2.502598e+11</td>\n","      <td>713940.0</td>\n","      <td>71</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-f73e9bff-c31a-425f-b4c4-0043ed140280')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-f73e9bff-c31a-425f-b4c4-0043ed140280 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-f73e9bff-c31a-425f-b4c4-0043ed140280');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":18}],"source":["# These are the boston greater area trips from GBQ\n","trips_sa = pd.read_csv('drive/MyDrive/Amenities/output/trips_bua_sa.csv', index_col = False)\n","trips_sa=trips_sa[trips_sa['naics_code'].notnull()]\n","trips_sa['naics_category'] = trips_sa['naics_code'].astype(str).str[:2].astype(int)\n","trips_sa=trips_sa.reset_index(drop=True)\n","trips_sa.head(2)"]},{"cell_type":"code","source":["len(trips_sa)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"_t3auhgWI1x1","executionInfo":{"status":"ok","timestamp":1673451773672,"user_tz":300,"elapsed":7,"user":{"displayName":"Maria Ibargoyen","userId":"09869936973664176898"}},"outputId":"9c407f89-1e05-4c57-900a-7ea2a989dceb"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["440295"]},"metadata":{},"execution_count":19}]},{"cell_type":"markdown","metadata":{"id":"mUF92AO2jHg4"},"source":["**Asociación Replica-Safegraph**"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"TmoOGeyZiBWr","colab":{"base_uri":"https://localhost:8080/","height":886},"executionInfo":{"status":"ok","timestamp":1673452136019,"user_tz":300,"elapsed":361653,"user":{"displayName":"Maria Ibargoyen","userId":"09869936973664176898"}},"outputId":"5249bb16-6928-4a12-9189-21a80a08b719"},"outputs":[{"output_type":"stream","name":"stdout","text":["0\n","100000\n","200000\n","300000\n","400000\n"]},{"output_type":"execute_result","data":{"text/plain":["         activity_id     person_id  household_id            mode  \\\n","0       1.415185e+19  3.820938e+18  4.456505e+18         CARPOOL   \n","1       5.174423e+18  1.503045e+19  1.449734e+19  PUBLIC_TRANSIT   \n","2       7.227650e+18  1.351501e+19  1.302200e+19  PUBLIC_TRANSIT   \n","3       4.033214e+18  3.120129e+17  1.708033e+19  PUBLIC_TRANSIT   \n","4       1.683543e+19  7.814222e+18  8.247398e+18  PUBLIC_TRANSIT   \n","...              ...           ...           ...             ...   \n","440290  1.105762e+18  3.116503e+18  1.609682e+19  PUBLIC_TRANSIT   \n","440291  1.668030e+19  5.583800e+18  1.412749e+19  PUBLIC_TRANSIT   \n","440292  1.751985e+19  2.340436e+18  1.128882e+19  PUBLIC_TRANSIT   \n","440293  1.628785e+19  1.811557e+19  2.923585e+18  PUBLIC_TRANSIT   \n","440294  8.300848e+18  2.204102e+18  7.358487e+17  PUBLIC_TRANSIT   \n","\n","             travel_purpose  duration_minutes  distance_miles   origin_bgrp  \\\n","0                RECREATION             111.0      101.180729  2.300502e+11   \n","1                RECREATION              59.0        7.325792  2.502505e+11   \n","2                RECREATION              49.0        5.426981  2.501735e+11   \n","3                      SHOP              67.0        5.954245  2.501734e+11   \n","4               MAINTENANCE              48.0        5.454942  2.502510e+11   \n","...                     ...               ...             ...           ...   \n","440290                  EAT              41.0        9.828978  2.502142e+11   \n","440291  OTHER_ACTIVITY_TYPE              41.0        3.871138  2.501735e+11   \n","440292          MAINTENANCE              41.0        4.718271  2.502140e+11   \n","440293                  EAT              41.0        3.693104  2.501735e+11   \n","440294                  EAT              42.0        3.868306  2.502140e+11   \n","\n","        destination_bgrp  naics_code  naics_category             placekey  \n","0           2.502507e+11    713940.0              71  239-222@62j-sj3-sqz  \n","1           2.502598e+11    713940.0              71  zzw-222@62j-sjg-nwk  \n","2           2.502500e+11    713940.0              71  zzw-222@62j-sgf-t35  \n","3           2.502506e+11    451140.0              45                       \n","4           2.502509e+11    812112.0              81  zzw-223@62j-sjc-kcq  \n","...                  ...         ...             ...                  ...  \n","440290      2.502507e+11    722515.0              72  22t-222@62j-shy-ysq  \n","440291      2.502501e+11    611110.0              61  222-222@62j-sgf-bhq  \n","440292      2.502503e+11    812113.0              81  226-222@62j-shz-qmk  \n","440293      2.502500e+11    722511.0              72  27t-223@62j-sgf-s3q  \n","440294      2.501735e+11    722511.0              72  224-222@62j-sj3-49z  \n","\n","[440295 rows x 12 columns]"],"text/html":["\n","  <div id=\"df-fbece37d-ea93-4663-ac5e-8ba370e42757\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>activity_id</th>\n","      <th>person_id</th>\n","      <th>household_id</th>\n","      <th>mode</th>\n","      <th>travel_purpose</th>\n","      <th>duration_minutes</th>\n","      <th>distance_miles</th>\n","      <th>origin_bgrp</th>\n","      <th>destination_bgrp</th>\n","      <th>naics_code</th>\n","      <th>naics_category</th>\n","      <th>placekey</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>1.415185e+19</td>\n","      <td>3.820938e+18</td>\n","      <td>4.456505e+18</td>\n","      <td>CARPOOL</td>\n","      <td>RECREATION</td>\n","      <td>111.0</td>\n","      <td>101.180729</td>\n","      <td>2.300502e+11</td>\n","      <td>2.502507e+11</td>\n","      <td>713940.0</td>\n","      <td>71</td>\n","      <td>239-222@62j-sj3-sqz</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>5.174423e+18</td>\n","      <td>1.503045e+19</td>\n","      <td>1.449734e+19</td>\n","      <td>PUBLIC_TRANSIT</td>\n","      <td>RECREATION</td>\n","      <td>59.0</td>\n","      <td>7.325792</td>\n","      <td>2.502505e+11</td>\n","      <td>2.502598e+11</td>\n","      <td>713940.0</td>\n","      <td>71</td>\n","      <td>zzw-222@62j-sjg-nwk</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>7.227650e+18</td>\n","      <td>1.351501e+19</td>\n","      <td>1.302200e+19</td>\n","      <td>PUBLIC_TRANSIT</td>\n","      <td>RECREATION</td>\n","      <td>49.0</td>\n","      <td>5.426981</td>\n","      <td>2.501735e+11</td>\n","      <td>2.502500e+11</td>\n","      <td>713940.0</td>\n","      <td>71</td>\n","      <td>zzw-222@62j-sgf-t35</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>4.033214e+18</td>\n","      <td>3.120129e+17</td>\n","      <td>1.708033e+19</td>\n","      <td>PUBLIC_TRANSIT</td>\n","      <td>SHOP</td>\n","      <td>67.0</td>\n","      <td>5.954245</td>\n","      <td>2.501734e+11</td>\n","      <td>2.502506e+11</td>\n","      <td>451140.0</td>\n","      <td>45</td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>1.683543e+19</td>\n","      <td>7.814222e+18</td>\n","      <td>8.247398e+18</td>\n","      <td>PUBLIC_TRANSIT</td>\n","      <td>MAINTENANCE</td>\n","      <td>48.0</td>\n","      <td>5.454942</td>\n","      <td>2.502510e+11</td>\n","      <td>2.502509e+11</td>\n","      <td>812112.0</td>\n","      <td>81</td>\n","      <td>zzw-223@62j-sjc-kcq</td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>440290</th>\n","      <td>1.105762e+18</td>\n","      <td>3.116503e+18</td>\n","      <td>1.609682e+19</td>\n","      <td>PUBLIC_TRANSIT</td>\n","      <td>EAT</td>\n","      <td>41.0</td>\n","      <td>9.828978</td>\n","      <td>2.502142e+11</td>\n","      <td>2.502507e+11</td>\n","      <td>722515.0</td>\n","      <td>72</td>\n","      <td>22t-222@62j-shy-ysq</td>\n","    </tr>\n","    <tr>\n","      <th>440291</th>\n","      <td>1.668030e+19</td>\n","      <td>5.583800e+18</td>\n","      <td>1.412749e+19</td>\n","      <td>PUBLIC_TRANSIT</td>\n","      <td>OTHER_ACTIVITY_TYPE</td>\n","      <td>41.0</td>\n","      <td>3.871138</td>\n","      <td>2.501735e+11</td>\n","      <td>2.502501e+11</td>\n","      <td>611110.0</td>\n","      <td>61</td>\n","      <td>222-222@62j-sgf-bhq</td>\n","    </tr>\n","    <tr>\n","      <th>440292</th>\n","      <td>1.751985e+19</td>\n","      <td>2.340436e+18</td>\n","      <td>1.128882e+19</td>\n","      <td>PUBLIC_TRANSIT</td>\n","      <td>MAINTENANCE</td>\n","      <td>41.0</td>\n","      <td>4.718271</td>\n","      <td>2.502140e+11</td>\n","      <td>2.502503e+11</td>\n","      <td>812113.0</td>\n","      <td>81</td>\n","      <td>226-222@62j-shz-qmk</td>\n","    </tr>\n","    <tr>\n","      <th>440293</th>\n","      <td>1.628785e+19</td>\n","      <td>1.811557e+19</td>\n","      <td>2.923585e+18</td>\n","      <td>PUBLIC_TRANSIT</td>\n","      <td>EAT</td>\n","      <td>41.0</td>\n","      <td>3.693104</td>\n","      <td>2.501735e+11</td>\n","      <td>2.502500e+11</td>\n","      <td>722511.0</td>\n","      <td>72</td>\n","      <td>27t-223@62j-sgf-s3q</td>\n","    </tr>\n","    <tr>\n","      <th>440294</th>\n","      <td>8.300848e+18</td>\n","      <td>2.204102e+18</td>\n","      <td>7.358487e+17</td>\n","      <td>PUBLIC_TRANSIT</td>\n","      <td>EAT</td>\n","      <td>42.0</td>\n","      <td>3.868306</td>\n","      <td>2.502140e+11</td>\n","      <td>2.501735e+11</td>\n","      <td>722511.0</td>\n","      <td>72</td>\n","      <td>224-222@62j-sj3-49z</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>440295 rows × 12 columns</p>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-fbece37d-ea93-4663-ac5e-8ba370e42757')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-fbece37d-ea93-4663-ac5e-8ba370e42757 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-fbece37d-ea93-4663-ac5e-8ba370e42757');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":20}],"source":["# Comentar que se hizo por Kdtree - mas intensivo computancionalmente, no aportaba gran valor por la falta de precisión de los datos de Replica\n","# trips_bga_sa: dataframe containing the trips to amenities carried out by Boston Metropolitan Area population (7M rows)\n","# safegraph_ma: dataframe containing POI information of MA\n","\n","# Initializing the placekey column\n","trips_sa['placekey'] = ''\n","#trips_sa['naics_code_safegraph'] = ''\n","# For loop running through the trips_bga_sa dataframe\n","for i in range(len(trips_sa)):\n","  # Extracting the block group and NAICS category of each trip (REPLICA)\n","  destination_bg = trips_sa.at[i, 'destination_bgrp']\n","  naics_code = trips_sa.at[i, 'naics_category']\n","  # Filtering POIs inside the block group with that NAICS category (SAFEGRAPH)\n","  pois_in_bg = safegraph_ma[(safegraph_ma['naics_category'] == naics_code) & (safegraph_ma['poi_cbg'] == destination_bg)]\n","  # Condition true if any POI meet the conditions\n","  if (pois_in_bg.empty == False):\n","  # Weighted randomization association based on Safegraph’s recorded visits. The first argument is the list of objects from which it must select one and the second argument is \n","  # the list of weights for each object of the list. Therefore, the placekey with more raw visits will be selected.\n","    #trips_sa.at[i, 'placekey'] = random.choices(list(pois_in_bg['placekey']), list(pois_in_bg['raw_visit_counts']))[0] #PABLO\n","    max_visits=pois_in_bg['raw_visit_counts'].max()\n","    pos=pois_in_bg.index[pois_in_bg['raw_visit_counts']==max_visits][0]\n","\n","    trips_sa.at[i, 'placekey'] =pois_in_bg.at[pos,'placekey']\n","    #trips_sa.at[i, 'naics_code_safegraph'] =pois_in_bg.at[pos,'naics_code']\n","    #trips_sa.at[i, 'naics_code_safegraph'] = pois_in_bg[(pois_in_bg['placekey']==trips_sa.at[i, 'placekey'])]['naics_code']\n","\n","  if i%100000 == 0:\n","    print(i)\n","trips_sa"]},{"cell_type":"code","source":["trips_sa.to_csv('drive/MyDrive/Amenities/output/BUA_trips_sa_placekey2.csv', encoding='utf-8', index=False)"],"metadata":{"id":"T5Kl8ylCZZ-6"},"execution_count":null,"outputs":[]}],"metadata":{"colab":{"provenance":[],"authorship_tag":"ABX9TyNf/RLSKXlPhf9HM9wLTmf0"},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}